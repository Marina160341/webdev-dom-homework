<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="commentContainer"></ul>
      <div class="add-form">
        <input 
          type="text" id="nameUser"
          class="add-form-name" 
          placeholder="Введите ваше имя"
              />
        <textarea
          type="textarea"
          class="add-form-text" id="textUser"
          placeholder="Введите ваш коментарий"
          rows="4"
          style="white-space:pre-line"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="buttonAdd">Написать</button>
        </div>
      </div>
    </div>
  </body>
<style>
  .error{
    background-color: red;
  }
  .no-click {pointer-events: none;
  background-color: aliceblue;}
</style>
<script>
  "use strict";

  const buttonElement = document.getElementById('buttonAdd');
  const commentContainerElement=document.getElementById('commentContainer');
  const commentlistElement=document.getElementById('commentList');
  const nameUserElement=document.getElementById('nameUser');
  const textUserElement=document.getElementById('textUser');
  const likesLink=document.querySelectorAll('.likes-counter');
  const commentText=document.getElementById('comment');
  const result= fetch ('https://wedev-api.sky.pro/api/v1/kemova-marina/comments' ,  
  {
      method: "GET",
});
console.log(result);
result.then((response) => {
  console.log(response);
   const jsonResult = response.json();
   console.log(jsonResult);
   jsonResult.then((responseData) =>{
     console.log(responseData);
     comments=responseData.comments;
renderComments();
});
  });
  
  let Data=new Date();
  const comments=[
  
    ] 
  Data=Data.toLocaleString();
  const anotherComments=()=>{
const commentsForm=document.querySelectorAll(".comment-body");
    for (const commentForm of commentsForm ){
      commentForm.addEventListener("click",()=>{
        console.log(commentForm);
        const oldComment = commentForm.dataset.text;
        const oldName = commentForm.dataset.name;
        textUserElement.value += `<${oldComment} \n ${oldName}.,`;

      }
   )};
 };
  const initEventListeners = ()=>{
  const likesButton=document.querySelectorAll(".like-button");
    for (const likeButton of likesButton ){
    likeButton.addEventListener("click", ()=>{
    const index = likeButton.dataset.index;
      if(comments[index].isliked){
         comments[index].isliked=false;
         comments[index].like--;
      }else{
         comments[index].like++;
         comments[index].isliked=true;
          };
  renderComments();
        });
        };
      };
  const renderComments=()=>{
  const commentHTML=comments.map((comment, index)=>{
  return `<li class="comment" style="white-space: pre-line">
          <div class="comment-header">
            <div>${comment.name}</div>
            <div>${comment.data}</div>
          </div>
          <div class="comment-body" id="comment-body" data-text = "${comment.comment}" data-name = "${comment.name}">
            <div class="comments">
              ${comment.comment}
          </div>
          </div>
          <div class="comment-footer">
            <div class="likes";
              <span class="likes-counter">${comment.like}</span>
              <button  id="like-button" class="like-button ${comment.isliked ? '-active-like': ''}" data-index="${index}"></button>
            </div>
          </div>
        </li>`;
      }).join('');
      commentContainerElement.innerHTML=commentHTML;
      initEventListeners();
      anotherComments();
      };
  renderComments();
  buttonElement.addEventListener("click", () => {
  nameUserElement.classList.remove('error');
  buttonElement.classList.remove('no-click')
      if (nameUserElement.value ==='') {
      nameUserElement.classList.add('error')
      return;
    }
      if (textUserElement.value === "") {
        textUserElement.classList.add('error');
        return
      }
      const result= fetch ('https://wedev-api.sky.pro/api/v1/kemova-marina/comments' ,  
  {
      method: "POST",
       body: JSON.stringify({ 
        text : textUserElement.value,
        name: nameUserElement.value
       })
});
console.log(result);
result.then((response) => {
  console.log(response);
   const jsonResult = response.json();
   console.log(jsonResult);
   jsonResult.then((responseData) =>{
    const appComments= responseData.comments.map((comment)=>{
      return {
        name: nameUserElement.value.replaceAll("<","&lt;").replaceAll(">","&gt;"),
        data: Data,
        comment:textUserElement.value.replaceAll("<","&lt;").replaceAll(">","&gt;"),
        like: 0,
        islike:false,
       }
    })
     comments=appComments;
     renderComments();
});
  });
  renderComments();
  nameUserElement.value="";
  textUserElement.value='';
      });
  renderComments();
    </script>
</html>
